@{
    ViewData["Title"] = "สร้างรายงาน";
    Layout = "_LayoutDashboard";
}

@if (TempData["ErrorMessage"] != null)
{
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            Swal.fire({
                title: 'แจ้งเตือน',
                text: '@TempData["ErrorMessage"]',
                icon: 'warning',
                confirmButtonColor: '#ff9800'
            });
        });
    </script>
}

<style>
    .report-container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 20px;
    }

    .report-card {
        background: white;
        border-radius: 12px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        padding: 30px;
        margin-bottom: 20px;
    }

    .top-buttons {
        position: sticky;
        top: 0;
        z-index: 1000;
        display: flex;
        gap: 15px;
        margin-bottom: 30px;
        justify-content: flex-end;
        background: white;
        padding: 20px 30px;
        border-radius: 12px;
        box-shadow: 0 2px 12px rgba(0, 0, 0, 0.15);
        backdrop-filter: blur(10px);
        transition: box-shadow 0.3s ease;
    }

        .top-buttons:hover {
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.2);
        }

        .top-buttons button {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
        }

    .btn-save {
        background: linear-gradient(135deg, #00bcd4, #009688);
        color: white;
    }

        .btn-save:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 188, 212, 0.3);
        }

    .btn-draft {
        background: linear-gradient(135deg, #ff9800, #ff5722);
        color: white;
    }

        .btn-draft:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(255, 152, 0, 0.3);
        }

    .btn-export {
        background: #6c757d;
        color: white;
    }

        .btn-export:hover {
            background: #5a6268;
            transform: translateY(-2px);
        }

    section {
        margin-bottom: 30px;
    }

    h2 {
        color: #1a1a2e;
        font-size: 20px;
        font-weight: 700;
        margin-bottom: 20px;
        padding-bottom: 10px;
        border-bottom: 3px solid #00bcd4;
    }

    h3 {
        color: #495057;
        font-size: 16px;
        font-weight: 600;
        margin: 20px 0 15px 0;
    }

    label {
        display: inline-block;
        color: #495057;
        font-size: 14px;
        font-weight: 500;
    }

    input[type="text"],
    input[type="number"],
    input[type="date"],
    input[type="time"],
    input[type="file"],
    textarea {
        padding: 8px 12px;
        border: 1px solid #ced4da;
        border-radius: 6px;
        font-size: 14px;
        transition: border-color 0.2s;
    }

        input[type="text"]:focus,
        input[type="number"]:focus,
        input[type="date"]:focus,
        input[type="time"]:focus,
        textarea:focus {
            outline: none;
            border-color: #00bcd4;
            box-shadow: 0 0 0 3px rgba(0, 188, 212, 0.1);
        }

    input[type="checkbox"] {
        width: 18px;
        height: 18px;
        cursor: pointer;
        margin-right: 6px;
    }

    .note {
        color: #6c757d;
        font-size: 12px;
        font-style: italic;
        margin-left: 10px;
    }

    table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 15px;
    }

    th, td {
        padding: 12px;
        text-align: left;
        border: 1px solid #dee2e6;
    }

    th {
        background: linear-gradient(135deg, #00bcd4, #009688);
        color: white;
        font-weight: 600;
        font-size: 14px;
    }

    td {
        background: white;
    }

    tr:hover td {
        background: #f8f9fa;
    }

    table input[type="text"],
    table input[type="number"],
    table textarea {
        width: 100%;
        border: 1px solid #dee2e6;
        padding: 6px 10px;
    }

    table textarea {
        min-height: 60px;
        resize: vertical;
    }

    .image-item {
        position: relative;
        width: 150px;
        height: 150px;
        border: 2px solid #dee2e6;
        border-radius: 8px;
        overflow: hidden;
        background: #f8f9fa;
    }

        .image-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .image-item .remove-btn {
            position: absolute;
            top: 5px;
            right: 5px;
            background: #f44336;
            color: white;
            border: none;
            border-radius: 50%;
            width: 25px;
            height: 25px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            transition: all 0.2s;
        }

            .image-item .remove-btn:hover {
                background: #d32f2f;
                transform: scale(1.1);
            }

    .form-row {
        margin-bottom: 15px;
    }

    @@media print {
        .no-print {
            display: none !important;
        }

        .report-card {
            box-shadow: none;
            padding: 10px;
        }

        body {
            background: white;
        }
    }
</style>

<form onsubmit="Save(event)">
    <div class="report-container">
        <div class="report-card">
            <!-- ปุ่มควบคุมด้านบน -->
            <div class="top-buttons no-print">
                <button type="submit" name="txt_status" class="btn-save" value="C">
                    <i class="fas fa-save"></i> บันทึกข้อมูล
                </button>
                <button type="submit" name="txt_status" class="btn-draft" value="D">
                    <i class="fas fa-file-alt"></i> บันทึก Draft
                </button>
            </div>

            <!-- SECTION 1 : Hull Cell Report -->
            <section id="hullcell">
                <h2>Hull Cell Report</h2>
                <div class="form-row d-flex align-items-center">
                    <div class="form-check form-check-inline">
                        <input class="form-check-input" type="radio" name="txt_line" id="line-zn-ni1" value="Zn-Ni1">
                        <label class="form-check-label" for="line-zn-ni1">
                            Zn-Ni1
                        </label>
                    </div>
                    <div class="form-check form-check-inline">
                        <input class="form-check-input" type="radio" name="txt_line" id="line-zn-ni2" value="Zn-Ni2">
                        <label class="form-check-label" for="line-zn-ni2">
                            Zn-Ni2
                        </label>
                        <p class="m-0 error text-danger" id="txt_line"></p>
                    </div>
                    <div class="form-check-inline">
                         Analysis by:
                        <input type="text" id="analysis-by" name="txt_analysis_by" class="form-control d-inline-block ms-2" style="width: 200px;" placeholder="รหัสพนักงาน">
                        <p class="m-0 error text-danger" id="txt_analysis_by"></p>
                        <span id="employee-name" style="margin-left: 10px; color: #00bcd4; font-weight: 600;"></span>
                    </div>
                </div>

                <div class="form-row">
                    <label style="width:150px;">Sampling Date:</label>
                    <input type="date" id="sampling-date" name="txt_sampling_date">
                    <p class="m-0 error text-danger" id="txt_sampling_date"></p>
                </div>
                <div class="form-row">
                    <label style="width:150px;">Time:</label>
                    <input type="time" id="time" name="txt_time">
                    <p class="m-0 error text-danger" id="txt_time"></p>
                </div>

                <h3>Composition Analysis</h3>
                <div class="form-row">
                    <label style="width:150px;">Zinc Metal:</label>
                    <input type="number" id="zinc-metal" name="txt_zinc_metal" step="0.01" oninput="calculateRatio()" style="width: 150px;">
                    <p class="m-0 error text-danger" id="txt_zinc_metal"></p>
                    <span class="note">(7.0–9.5 g/L)</span>
                </div>
                <div class="form-row">
                    <label style="width:150px;">Caustic Soda:</label>
                    <input type="number" id="caustic-soda" name="txt_caustic_soda" step="0.01" style="width: 150px;">
                    <p class="m-0 error text-danger" id="txt_caustic_soda"></p>
                    <span class="note">(105–125 g/L)</span>
                </div>
                <div class="form-row">
                    <label style="width:150px;">Sodium Carbonate:</label>
                    <input type="number" id="sodium-carbonate" name="txt_sodium_carbonate" step="0.01" style="width: 150px;">
                    <p class="m-0 error text-danger" id="txt_sodium_carbonate"></p>
                    <span class="note">(&lt;130 g/L)</span>
                </div>
                <div class="form-row">
                    <label style="width:150px;">Nickel:</label>
                    <input type="number" id="nickel" name="txt_nickel" step="0.01" oninput="calculateRatio()" style="width: 150px;">
                    <p class="m-0 error text-danger" id="txt_nickel"></p>
                    <span class="note">(1.4–2.6 g/L)</span>
                </div>
                <div class="form-row">
                    <label style="width:150px;">US-208T:</label>
                    <input type="number" id="us-208t" name="txt_us_208t" step="0.01" style="width: 150px;">
                    <p class="m-0 error text-danger" id="txt_us_208t"></p>
                    <span class="note">(120–160 g/L)</span>
                </div>
                <div class="form-row">
                    <label style="width:150px;">Ratio Zn/Ni:</label>
                    <input type="text" id="ratio" name="txt_ratio" readonly style="width: 150px; background: #e9ecef;">
                </div>
            </section>

            <!-- SECTION 2 : Parameter Table -->
            <section id="parameter">
                <h2>Parameter Table</h2>
                <table id="parameter-table">
                    <thead>
                        <tr>
                            <th>Parameter</th>
                            <th>Start</th>
                            <th>Finish</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Temp (°C)</td>
                            <td>
                                <input type="number" step="0.01" name="txt_temp_start">
                                <p class="m-0 error text-danger" id="txt_temp_start"></p>
                            </td>
                            <td>
                                <input type="number" step="0.01" name="txt_temp_finish">
                                <p class="m-0 error text-danger" id="txt_temp_finish"></p>
                            </td>
                        </tr>
                        <tr>
                            <td>Voltage (V)</td>
                            <td>
                                <input type="number" step="0.01" name="txt_voltage_start">
                                <p class="m-0 error text-danger" id="txt_voltage_start"></p>
                            </td>
                            <td>
                                <input type="number" step="0.01" name="txt_voltage_finish">
                                <p class="m-0 error text-danger" id="txt_voltage_finish"></p>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </section>

            <!-- SECTION 3 : X-ray Program -->
            <section id="xray">
                <h2>Program X-ray No.13 Zn/Ni/En/Fe</h2>
                <table id="xray-table">
                    <thead>
                        <tr>
                            <th rowspan="2">Point</th>
                            <th rowspan="2">A/dm²</th>
                            <th colspan="2">Thickness (µm)</th>
                            <th rowspan="2">% Zn (85.0–90.0)</th>
                            <th rowspan="2">% Ni (10.0–15.0)</th>
                        </tr>
                        <tr>
                            <th>Spec</th>
                            <th>Result</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>1 cm</td>
                            <td>16.9</td>
                            <td>12–15</td>
                            <td>
                                <input type="number" step="0.01" name="txt_result_1cm" oninput="calculateMaxMin()">
                                <p class="m-0 error text-danger" id="txt_result_1cm"></p>
                            </td>
                            <td>
                                <input type="number" step="0.01" name="txt_zn_1cm" oninput="calculateMaxMin()">
                                <p class="m-0 error text-danger" id="txt_zn_1cm"></p>
                            </td>
                            <td>
                                <input type="number" step="0.01" name="txt_ni_1cm" oninput="calculateMaxMin()">
                                <p class="m-0 error text-danger" id="txt_ni_1cm"></p>
                            </td>
                        </tr>
                        <tr>
                            <td>3 cm</td>
                            <td>9.2</td>
                            <td>8–11</td>
                            <td>
                                <input type="number" step="0.01" name="txt_result_3cm" oninput="calculateMaxMin()">
                                <p class="m-0 error text-danger" id="txt_result_3cm"></p>
                            </td>
                            <td>
                                <input type="number" step="0.01" name="txt_zn_3cm" oninput="calculateMaxMin()">
                                <p class="m-0 error text-danger" id="txt_zn_3cm"></p>
                            </td>
                            <td>
                                <input type="number" step="0.01" name="txt_ni_3cm" oninput="calculateMaxMin()">
                                <p class="m-0 error text-danger" id="txt_ni_3cm"></p>
                            </td>
                        </tr>
                        <tr>
                            <td>5 cm</td>
                            <td>5.6</td>
                            <td>5–8</td>
                            <td>
                                <input type="number" step="0.01" name="txt_result_5cm" oninput="calculateMaxMin()">
                                <p class="m-0 error text-danger" id="txt_result_5cm"></p>
                            </td>
                            <td>
                                <input type="number" step="0.01" name="txt_zn_5cm" oninput="calculateMaxMin()">
                                <p class="m-0 error text-danger" id="txt_zn_5cm"></p>
                            </td>
                            <td>
                                <input type="number" step="0.01" name="txt_ni_5cm" oninput="calculateMaxMin()">
                                <p class="m-0 error text-danger" id="txt_ni_5cm"></p>
                            </td>
                        </tr>
                        <tr>
                            <td>7 cm</td>
                            <td>3.2</td>
                            <td>3–6</td>
                            <td>
                                <input type="number" step="0.01" name="txt_result_7cm" oninput="calculateMaxMin()">
                                <p class="m-0 error text-danger" id="txt_result_7cm"></p>
                            </td>
                            <td>
                                <input type="number" step="0.01" name="txt_zn_7cm" oninput="calculateMaxMin()">
                                <p class="m-0 error text-danger" id="txt_zn_7cm"></p>
                            </td>
                            <td>
                                <input type="number" step="0.01" name="txt_ni_7cm" oninput="calculateMaxMin()">
                                <p class="m-0 error text-danger" id="txt_ni_7cm"></p>
                            </td>
                        </tr>
                        <tr>
                            <td>9 cm</td>
                            <td>2.0</td>
                            <td>2–4</td>
                            <td>
                                <input type="number" step="0.01" name="txt_result_9cm" oninput="calculateMaxMin()">
                                <p class="m-0 error text-danger" id="txt_result_9cm"></p>
                            </td>
                            <td>
                                <input type="number" step="0.01" name="txt_zn_9cm" oninput="calculateMaxMin()">
                                <p class="m-0 error text-danger" id="txt_zn_9cm"></p>
                            </td>
                            <td>
                                <input type="number" step="0.01" name="txt_ni_9cm" oninput="calculateMaxMin()">
                                <p class="m-0 error text-danger" id="txt_ni_9cm"></p>
                            </td>
                        </tr>
                        <tr>
                            <td>19 cm</td>
                            <td>0.5</td>
                            <td>0.5</td>
                            <td>
                                <input type="number" step="0.01" name="txt_result_19cm" oninput="calculateMaxMin()">
                                <p class="m-0 error text-danger" id="txt_result_19cm"></p>
                            </td>
                            <td>
                                <input type="number" step="0.01" name="txt_zn_19cm" oninput="calculateMaxMin()">
                                <p class="m-0 error text-danger" id="txt_zn_19cm"></p>
                            </td>
                            <td>
                                <input type="number" step="0.01" name="txt_ni_19cm" oninput="calculateMaxMin()">
                                <p class="m-0 error text-danger" id="txt_ni_19cm"></p>
                            </td>
                        </tr>
                        <tr style="background: #f8f9fa;">
                            <td colspan="3"><strong>Max.</strong></td>
                            <td><input type="number" step="0.01" name="txt_max_result" readonly style="background: #e9ecef;"></td>
                            <td><input type="number" step="0.01" name="txt_max_zn" readonly style="background: #e9ecef;"></td>
                            <td><input type="number" step="0.01" name="txt_max_ni" readonly style="background: #e9ecef;"></td>
                        </tr>
                        <tr style="background: #f8f9fa;">
                            <td colspan="3"><strong>Min.</strong></td>
                            <td><input type="number" step="0.01" name="txt_min_result" readonly style="background: #e9ecef;"></td>
                            <td><input type="number" step="0.01" name="txt_min_zn" readonly style="background: #e9ecef;"></td>
                            <td><input type="number" step="0.01" name="txt_min_ni" readonly style="background: #e9ecef;"></td>
                        </tr>
                    </tbody>
                </table>
            </section>

            <!-- SECTION 4 : Zn Conc Table -->
            <section id="znconc">
                <h2>Zn Conc. Table</h2>
                <table id="zn-table">
                    <thead>
                        <tr>
                            <th>Zn Conc (g/L)</th>
                            <th>ความหนา 1 cm</th>
                            <th>% Zn</th>
                            <th>% Ni</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>7.33–7.59</td>
                            <td>13–14</td>
                            <td>85–86%</td>
                            <td>14–15%</td>
                        </tr>
                        <tr>
                            <td>7.72–7.86</td>
                            <td>14–15</td>
                            <td>85–86%</td>
                            <td>14–15%</td>
                        </tr>
                        <tr>
                            <td>7.99–8.18</td>
                            <td>15–16</td>
                            <td>85–86%</td>
                            <td>14–15%</td>
                        </tr>
                        <tr>
                            <td>&gt; 8.30</td>
                            <td>16–17</td>
                            <td></td>
                            <td></td>
                        </tr>
                    </tbody>
                </table>
            </section>

            <!-- SECTION 5 : Adjustment Table -->
            <section id="adjustment">
                <h2>Adjustment Table</h2>
                <table id="adjustment-table">
                    <thead>
                        <tr>
                            <th>Chem.</th>
                            <th>แช่ซิงค์</th>
                            <th>ปรับเติม</th>
                            <th>Auto feed</th>
                            <th>Remark</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>Zn</strong></td>
                            <td><textarea readonly name="txt_batch_zn"></textarea></td>
                            <td><textarea readonly name="txt_adjust_zn"></textarea></td>
                            <td><textarea readonly name="txt_auto_feed_zn"></textarea></td>
                            <td><textarea readonly name="txt_remark_zn"></textarea></td>
                        </tr>
                        <tr>
                            <td><strong>NaOH</strong></td>
                            <td><textarea readonly name="txt_batch_naoh"></textarea></td>
                            <td><textarea readonly name="txt_adjust_naoh"></textarea></td>
                            <td><textarea readonly name="txt_auto_feed_naoh"></textarea></td>
                            <td><textarea readonly name="txt_remark_naoh"></textarea></td>
                        </tr>
                        <tr>
                            <td><strong>208N</strong></td>
                            <td><textarea readonly name="txt_batch_208n"></textarea></td>
                            <td><textarea readonly name="txt_adjust_208n"></textarea></td>
                            <td><textarea readonly name="txt_auto_feed_208n"></textarea></td>
                            <td><textarea readonly name="txt_remark_208n"></textarea></td>
                        </tr>
                        <tr>
                            <td><strong>208T</strong></td>
                            <td><textarea readonly name="txt_batch_208t"></textarea></td>
                            <td><textarea readonly name="txt_adjust_208t"></textarea></td>
                            <td><textarea readonly name="txt_auto_feed_208t"></textarea></td>
                            <td><textarea readonly name="txt_remark_208t"></textarea></td>
                        </tr>
                        <tr>
                            <td><strong>208A</strong></td>
                            <td><textarea readonly name="txt_batch_208a"></textarea></td>
                            <td><textarea readonly name="txt_adjust_208a"></textarea></td>
                            <td><textarea readonly name="txt_auto_feed_208a"></textarea></td>
                            <td><textarea readonly name="txt_remark_208a"></textarea></td>
                        </tr>
                        <tr>
                            <td><strong>208B</strong></td>
                            <td><textarea readonly name="txt_batch_208b"></textarea></td>
                            <td><textarea readonly name="txt_adjust_208b"></textarea></td>
                            <td><textarea readonly name="txt_auto_feed_208b"></textarea></td>
                            <td><textarea readonly name="txt_remark_208b"></textarea></td>
                        </tr>
                    </tbody>
                </table>
            </section>

            <!-- SECTION 6 : Upload -->
            <section id="upload">
                <h2>Upload Images</h2>
                <input type="file" id="file_upload" name="txt_file_upload" accept="image/*" multiple>
                <p class="note">*รองรับไฟล์ภาพ: JPG, JPEG, PNG, GIF, BMP</p>
                
                <div id="uploaded-images-container" style="margin-top: 20px; display: none;">
                    <h3 style="font-size: 16px; color: #495057; margin-bottom: 10px;">ภาพที่อัพโหลดแล้ว:</h3>
                    <div id="uploaded-images-list" style="display: flex; flex-wrap: wrap; gap: 15px;">
                        <!-- Uploaded images will be displayed here -->
                    </div>
                    <input type="hidden" id="deleted-images" name="deleted_images" value="">
                </div>

                <div id="preview-container" style="margin-top: 20px; display: none;">
                    <h3 style="font-size: 16px; color: #495057; margin-bottom: 10px;">ตัวอย่างภาพที่เลือก:</h3>
                    <div id="image-preview" style="display: flex; flex-wrap: wrap; gap: 15px;">
                        <!-- Preview images will be displayed here -->
                    </div>
                </div>
            </section>
        </div>
    </div>
</form>

@section Scripts {
    <script src="~/js/Home/vCreateReport.js" asp-append-version="true"></script>
    <script src="~/js/Home/vCreateReport_load.js" asp-append-version="true"></script>
}
